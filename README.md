# GsShop-searchBar-Upgrade

자세한 기술과 영상 설명은 아래의 노션을 클릭해주세요:  
[Notion 페이지](https://intriguing-cowl-e9d.notion.site/Gs-Shop-a8483fbf0769446a9411ec2e8f19e72c?pvs=4)

## 목표
**목표:** 현업에서 활약하고 있는 개발 선배님들의 실력 따라잡기</br></br>

## 문제 발생

사용자가 검색을 시도할 때, 데이터베이스에서 연관 검색어를 받아와 표시하는 과정에서 화면의 번쩍임 현상이 발생하였습니다. 이 문제는 사용자가 "안녕"이라는 단어를 검색할 때, 'ㅇ', 'ㅏ', 'ㄴ', 'ㄴ', 'ㅕ', 'ㅇ' 총 6번의 화면이 `setState` 되는 문제였습니다. 이로 인해 사용자는 과도한 번쩍거림 현상을 경험하게 되어 UX가 저하되는 문제가 발생하였으며, 이를 개선하고자 합니다.
</br></br></br>
## 문제 해결

### 접근

#### 잘못된 접근 방법

1. **애니메이션 사용:**

Flutter의 `AnimatedOpacity` 위젯을 사용해 연관 검색어 리스트의 표시를 부드럽게 전환하려 했습니다. 그러나 위젯의 투명도를 관리하는 전환 효과는 번쩍임 효과를 없애지 못했습니다.

1.1 **잘못된 접근 방법인 이유:**  
서버에서 값을 새로 받아왔을 때 `setState`를 통해 화면이 새로고침되면 애니메이션보다 화면의 새로고침되는 번쩍임이 우선적으로 나타났기 때문입니다.
</br></br></br>
#### 올바른 접근 방법

1. **상태관리 개선:**

검색어 입력 시 매번 화면을 갱신하는 대신 `FutureBuilder`와 `Provider`를 통해 상태 관리를 개선할 수 있는 방법을 고민해보았습니다. 사용자가 입력한 값을 리스트에 담아 사용자가 다음 초성을 입력했을 때, 리스트에 없다면 서버에 다시 한번 요청하고, 리스트에 있다면 리스트 안의 값을 재사용해 불필요한 서버와의 연결을 최소화하고자 했습니다.

1.1 **데이터 캐싱:**  
1번의 상태관리 개선의 재사용을 조금 더 명확하게 설명하면, 검색어가 비어있거나 연관 검색어가 없을 경우 이전 검색어 히스토리를 표시하도록 하여 불필요한 API 호출을 줄였습니다. 이를 통해 불필요한 화면 갱신을 방지했습니다.

2. **생명주기 개선:**

`didChangeDependencies` 메서드를 사용해 초기 로딩 상태를 제어하는 방법으로 접근해 보았습니다. 초기 화면 로딩 시 `_isFirstSearchBar` 변수를 `false`로 설정해 `FutureBuilder`에서 로딩 상태를 정확히 관리할 수 있도록 했습니다.

```dart
@override
void didChangeDependencies() {
  super.didChangeDependencies();
  _isFirstSearchBar = false;
}
```
이와 함께 FutureBuilder에서 snapshot.connectionState와 _isFirstSearchBar를 사용하여 첫 번째 검색 시 로딩 상태를 적절히 처리했습니다.

```dart
if (snapshot.connectionState == ConnectionState.waiting && _isFirstSearchBar) {
  return const SizedBox();
}
```
</br></br></br>

### 리뷰
Flutter 개발 중 너무 중요하지만 깊게 고민해보지 못했던 문제를 여러 관점에서 정말 많은 시간 고민해보았습니다. 답을 알고 난 뒤에는 너무 간단하고 쉽게 접근할 수 있는 문제였지만, 그 해결 과정을 도출해내는 과정은 너무나 힘들고 괴로운 시간이었습니다. 그러나 여러 가지 관점으로 접근하고 도전하는 계기를 제공한 대기업 앱의 재해석 공부 방법은 뿌듯함과 함께 한층 더 성장할 수 있는 기회를 얻을 수 있었습니다.





